// <auto-generated>
// This source code was auto-generated by StateGenerator.cs
// </auto-generated>

using System.Runtime.CompilerServices;
using AnotherECS.Converter;
using AnotherECS.Core;
using AnotherECS.Gen.Common;

namespace AnotherECS.Gen.Project
{
    public sealed class <#STATE:GEN_NAME#> : <#STATE:NAME#>
    {
        
        private FastAccess _fast;
        public ref readonly FastAccess Fast => ref _fast;


        protected override void BindingCodeGenerationStage(in GeneralConfig general)
        {
            ComponentGlobalInstaller_<#STATE:GEN_NAME#>.Install();
            SystemGlobalInstaller_<#STATE:GEN_NAME#>.Install();

<#ARRAY [0..COMPONENT:COUNT]#>
            LayoutInstaller.Add_<#COMPONENT:FULL_NAME_AS_TEXT#>(this);
<#END#>
            UpdateFastAccess();
        }

        private void UpdateFastAccess()
        {
            _fast = new FastAccess(this);
        }

        protected override uint GetComponentCount()
            => <#COMPONENT:COUNT#>;

        protected override ushort GetIndex<T>()
            => CompileComponentIdProvider<<#STATE:GEN_NAME#>, T>.ID;

        protected override void OnTickFinished()
        {
<#ARRAY [0..COMPONENT:COUNT]#>
            
<#END#>
        }

        public struct FastAccess
        {
<#ARRAY [0..COMPONENT:FASTACCESS:COUNT]#>
            private <#CALLER:FASTACCESS:TYPE_NAME#>_FA<<#COMPONENT:FASTACCESS:FULL_NAME#>> _fa<#COMPONENT:FASTACCESS:NAME#>;
<#END#>
            internal FastAccess(State state)
            {
<#ARRAY [0..COMPONENT:FASTACCESS:COUNT]#>
                _fa<#COMPONENT:FASTACCESS:NAME#> = state.CreateFA<<#COMPONENT:FASTACCESS:FULL_NAME#>, <#CALLER:FASTACCESS:TYPE_NAME#>_Caller<<#COMPONENT:FASTACCESS:FULL_NAME#>>, <#CALLER:FASTACCESS:TYPE_NAME#>_FA<<#COMPONENT:FASTACCESS:FULL_NAME#>>>();
<#END#>
            }
<#ARRAY [0..COMPONENT:FASTACCESS:COUNT]#>
            public <#CALLER:FASTACCESS:TYPE_NAME#>_FA<<#COMPONENT:FASTACCESS:FULL_NAME#>> <#COMPONENT:FASTACCESS:NAME#> { [MethodImpl(MethodImplOptions.AggressiveInlining)] get => _fa<#COMPONENT:FASTACCESS:NAME#>; }
<#END#>
        }
    }
}