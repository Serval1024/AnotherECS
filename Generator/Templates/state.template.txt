// <auto-generated>
// This source code was auto-generated by StateGenerator.cs
// </auto-generated>

using System.Runtime.CompilerServices;
using AnotherECS.Core;
using AnotherECS.Core.Converter;
using AnotherECS.Gen.Common;
using AnotherECS.Serializer;

namespace AnotherECS.Gen.Project
{
    public sealed class <#STATE:GEN_NAME#> : State, IState
    {
        
        private FastAccess _fast;
        public ref readonly FastAccess Fast => ref _fast;


        public <#STATE:GEN_NAME#>() : base() { }
        public <#STATE:GEN_NAME#>(in StateConfig config) : base(in config) { }
        public <#STATE:GEN_NAME#>(ref ReaderContextSerializer reader) : base(ref reader) { }

        protected override void BindingCodeGenerationStage(in StateConfig config)
        {
            ComponentInstaller.Install();
            SystemInstaller.Install();

<#ARRAY [0..COMPONENT:COUNT]#>
            LayoutInstaller.Install_<#COMPONENT:FULL_NAME_AS_TEXT#>(this);
<#END#>
            UpdateFastAccess();
        }

        private void UpdateFastAccess()
        {
            _fast = new FastAccess(this);
        }

        protected override uint GetComponentCount()
            => <#COMPONENT:COUNT#>;

        protected override ushort GetIndex<T>()
            => CompileComponentIdProvider<<#STATE:GEN_NAME#>, T>.ID;

        protected override uint GetConfigCount()
            => <#CONFIG:COUNT#>;

        protected override ushort GetConfigIndex<T>()
            => CompileConfigIdProvider<<#STATE:GEN_NAME#>, T>.ID;


        public struct FastAccess
        {
<#ARRAY [0..COMPONENT:FASTACCESS:COUNT]#>
            private <#CALLER:FASTACCESS:TYPE_NAME#>_FA<<#COMPONENT:FASTACCESS:FULL_NAME#>> _fa<#COMPONENT:FASTACCESS:NAME#>;
<#END#>
            internal FastAccess(State state)
            {
<#ARRAY [0..COMPONENT:FASTACCESS:COUNT]#>
                _fa<#COMPONENT:FASTACCESS:NAME#> = state.CreateFA<<#COMPONENT:FASTACCESS:FULL_NAME#>, <#CALLER:FASTACCESS:TYPE_NAME#>_FA<<#COMPONENT:FASTACCESS:FULL_NAME#>>>();
<#END#>
            }
<#ARRAY [0..COMPONENT:FASTACCESS:COUNT]#>
            public <#CALLER:FASTACCESS:TYPE_NAME#>_FA<<#COMPONENT:FASTACCESS:FULL_NAME#>> <#COMPONENT:FASTACCESS:NAME#> { [MethodImpl(MethodImplOptions.AggressiveInlining)] get => _fa<#COMPONENT:FASTACCESS:NAME#>; }
<#END#>
        }


<#EMBENED:ComponentInstallerGenerator.cs#>
    }
}